
=== MINIFIED AND ESCAPED SNIPPET FOR EASYSTORE ===

Copy the content between the START and END markers below and paste it into your Postman request body:

=== START ===
<script>(function (){'use strict';const CONFIG={availabilityEndpoint:window.location.hostname.includes('ngrok')? `${window.location.protocol}:'https:daysAhead:30,minDaysAhead:2};let selectedDate=null;let selectedTime=null;let availabilityCache={};let businessHours=null;function ready(fn){if (document.readyState!=='loading'){fn();} else {document.addEventListener('DOMContentLoaded',fn);}} function initBookingWidget(){const buyNowButton=document.getElementById('BuyNowButton');if (!buyNowButton){console.log('BuyNowButton not found,retrying in 1 second...');setTimeout(initBookingWidget,1000);return;} buyNowButton.disabled=true;buyNowButton.style.opacity='0.5';buyNowButton.style.cursor='not-allowed';hideAddToCartButton();hideAndSetQuantity();createBookingWidget(buyNowButton);addCustomStyles();setTimeout(()=>disableBuyNowButton(),100);} function createBookingWidget(buyNowButton){const bookingContainer=document.createElement('div');bookingContainer.id='booking-widget';bookingContainer.innerHTML=`<div class=\"booking-widget-container\"><div class=\"booking-step\"id=\"date-selection\"><h4>Choose a Date</h4><div id=\"calendar-container\"><div class=\"calendar-header\"><button id=\"prev-month\"class=\"nav-button\"><svg width=\"20\"height=\"20\"viewBox=\"0 0 24 24\"fill=\"none\"stroke=\"currentColor\"stroke-width=\"2\"stroke-linecap=\"round\"stroke-linejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg></button><span id=\"current-month\"></span><button id=\"next-month\"class=\"nav-button\"><svg width=\"20\"height=\"20\"viewBox=\"0 0 24 24\"fill=\"none\"stroke=\"currentColor\"stroke-width=\"2\"stroke-linecap=\"round\"stroke-linejoin=\"round\"><polyline points=\"9 18 15 12 9 6\"></polyline></svg></button></div><div id=\"calendar-grid\"></div></div><div id=\"availability-loading\"class=\"loading-indicator\"style=\"display:none;\">Checking availability...</div></div><div class=\"booking-step\"id=\"time-selection\"style=\"display:none;\"><h4>Choose a Time</h4><div id=\"time-slots\"></div><button id=\"change-date\"class=\"secondary-button\"><svg width=\"16\"height=\"16\"viewBox=\"0 0 24 24\"fill=\"none\"stroke=\"currentColor\"stroke-width=\"2\"stroke-linecap=\"round\"stroke-linejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>Change Date</button></div><div class=\"booking-summary\"id=\"booking-summary\"style=\"display:none;\"><div class=\"summary-content\"><strong>Selected Booking:</strong><div id=\"selected-booking-details\"></div></div></div></div>`;buyNowButton.parentNode.insertBefore(bookingContainer,buyNowButton);initCalendar();setupEventListeners();} function initCalendar(){const today=new Date();const minDate=new Date(today);minDate.setDate(today.getDate()+CONFIG.minDaysAhead);displayCalendar(minDate);} function displayCalendar(date){const monthNames=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"];const dayNames=[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"];const currentMonth=document.getElementById('current-month');const calendarGrid=document.getElementById('calendar-grid');currentMonth.textContent=`${monthNames[date.getMonth()]}${date.getFullYear()}`;calendarGrid.innerHTML='';const headerRow=document.createElement('div');headerRow.className='calendar-row calendar-header-row';dayNames.forEach(day=>{const dayHeader=document.createElement('div');dayHeader.className='calendar-day-header';dayHeader.textContent=day;headerRow.appendChild(dayHeader);});calendarGrid.appendChild(headerRow);const firstDay=new Date(date.getFullYear(),date.getMonth(),1);const lastDay=new Date(date.getFullYear(),date.getMonth()+1,0);const startDate=new Date(firstDay);startDate.setDate(startDate.getDate()-firstDay.getDay());const today=new Date();const minBookingDate=new Date(today);minBookingDate.setDate(today.getDate()+CONFIG.minDaysAhead);let currentDate=new Date(startDate);while (currentDate<=lastDay||currentDate.getDay()!==0){const row=document.createElement('div');row.className='calendar-row';for (let i=0;i<7;i++){const dayElement=document.createElement('div');dayElement.className='calendar-day';const isCurrentMonth=currentDate.getMonth()===date.getMonth();const isPastDate=currentDate<minBookingDate;const isTooFarAhead=currentDate>new Date(today.getFullYear(),today.getMonth(),today.getDate()+CONFIG.daysAhead);if (!isCurrentMonth){dayElement.classList.add('other-month');} else if (isPastDate||isTooFarAhead){dayElement.classList.add('disabled');} else {dayElement.classList.add('available-date');(function (capturedDate){dayElement.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();selectDate(new Date(capturedDate));});})(new Date(currentDate));} dayElement.textContent=currentDate.getDate();dayElement.dataset.date=currentDate.toISOString().split('T')[0];row.appendChild(dayElement);currentDate.setDate(currentDate.getDate()+1);} calendarGrid.appendChild(row);} loadAvailabilityForMonth(date);} async function loadAvailabilityForMonth(date){const loadingIndicator=document.getElementById('availability-loading');loadingIndicator.style.display='block';try {const startDate=new Date(date.getFullYear(),date.getMonth(),1);const endDate=new Date(date.getFullYear(),date.getMonth()+1,0);const response=await fetch(`${CONFIG.availabilityEndpoint}?start=${startDate.toISOString().split('T')[0]}&end=${endDate.toISOString().split('T')[0]}`);const availability=await response.json();if (availability.businessHours){businessHours=availability.businessHours;console.log('Stored business hours from month view:',businessHours);} availability.dates.forEach(dateInfo=>{const dayElement=document.querySelector(`[data-date=\"${dateInfo.date}\"]`);if (dayElement&&dayElement.classList.contains('available-date')){if (dateInfo.available){dayElement.classList.add('has-availability');} else {dayElement.classList.add('fully-booked');}}});availability.dates.forEach(dateInfo=>{availabilityCache[dateInfo.date]=dateInfo.slots;});} catch (error){console.error('Error loading availability:',error);document.querySelectorAll('.available-date').forEach(day=>{day.classList.add('has-availability');});} loadingIndicator.style.display='none';} async function selectDate(date){const dateStr=date.toISOString().split('T')[0];selectedDate=dateStr;document.querySelectorAll('.calendar-day').forEach(day=>{day.classList.remove('selected');});const selectedDay=document.querySelector(`[data-date=\"${dateStr}\"]`);if (selectedDay){selectedDay.classList.add('selected');} await loadTimeSlots(date);document.getElementById('date-selection').style.display='none';document.getElementById('time-selection').style.display='block';} async function loadTimeSlots(date){const timeSlotsContainer=document.getElementById('time-slots');timeSlotsContainer.innerHTML='<div class=\"loading\">Loading available times...</div>';try {const dateStr=date.toISOString().split('T')[0];let availableSlots=availabilityCache[dateStr];if (!availableSlots||!businessHours){console.log('Fetching availability for date:',dateStr);const response=await fetch(`${CONFIG.availabilityEndpoint}?date=${dateStr}`);const data=await response.json();console.log('API response:',data);availableSlots=data.slots||[];if (data.businessHours){businessHours=data.businessHours;console.log('Loaded business hours from API:',businessHours);}} const dayName=date.toLocaleDateString('en-US',{weekday:'long'});if (!businessHours){console.error('Business hours not loaded!This should not happen.');timeSlotsContainer.innerHTML='<div class=\"error\">Error:Business hours not loaded. Please refresh and try again.</div>';return;} const dayBusinessHours=businessHours[dayName]||[];console.log(`Time slots for ${dayName}:`,dayBusinessHours);if (dayBusinessHours.length===0){timeSlotsContainer.innerHTML='<div class=\"no-slots\">Sorry,we\\'re closed on this day.</div>';return;} timeSlotsContainer.innerHTML='';let hasAvailableSlots=false;dayBusinessHours.forEach(time=>{const slotButton=document.createElement('button');slotButton.className='time-slot';slotButton.textContent=time;const isAvailable=!availableSlots||availableSlots.includes(time);if (isAvailable){hasAvailableSlots=true;slotButton.classList.add('available');slotButton.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();selectTime(time,e);});} else {slotButton.classList.add('booked');slotButton.disabled=true;} timeSlotsContainer.appendChild(slotButton);});if (!hasAvailableSlots){const noSlotsMsg=document.createElement('div');noSlotsMsg.className='no-slots';noSlotsMsg.textContent='Sorry,no time slots available on this date.';timeSlotsContainer.appendChild(noSlotsMsg);}} catch (error){console.error('Error loading time slots:',error);timeSlotsContainer.innerHTML='<div class=\"error\">Error loading times. Please try again.</div>';}} function selectTime(time,event){selectedTime=time;document.querySelectorAll('.time-slot').forEach(slot=>{slot.classList.remove('selected');});if (event&&event.target){event.target.classList.add('selected');} updateBookingSummary();enableBuyNowButton();} function updateBookingSummary(){const summaryContainer=document.getElementById('booking-summary');const detailsContainer=document.getElementById('selected-booking-details');if (selectedDate&&selectedTime){const date=new Date(selectedDate);const formattedDate=date.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});detailsContainer.innerHTML=`<div class=\"booking-detail\">${formattedDate}</div><div class=\"booking-detail\">${selectedTime}</div>`;summaryContainer.style.display='block';updateEasyStoreForm();}} function updateEasyStoreForm(){const form=document.getElementById('BuyNowButton')?.closest('form');if (!form) return;let bookingDateInput=form.querySelector('input[name=\"properties[Booking Date]\"]');let bookingTimeInput=form.querySelector('input[name=\"properties[Booking Time]\"]');if (!bookingDateInput){bookingDateInput=document.createElement('input');bookingDateInput.type='hidden';bookingDateInput.name='properties[Booking Date]';form.appendChild(bookingDateInput);} if (!bookingTimeInput){bookingTimeInput=document.createElement('input');bookingTimeInput.type='hidden';bookingTimeInput.name='properties[Booking Time]';form.appendChild(bookingTimeInput);} bookingDateInput.value=selectedDate;bookingTimeInput.value=selectedTime;} function setupEventListeners(){document.getElementById('prev-month').addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();const currentMonth=document.getElementById('current-month').textContent;const[monthName,year]=currentMonth.split(' ');const monthIndex=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"].indexOf(monthName);const newDate=new Date(parseInt(year),monthIndex-1,1);displayCalendar(newDate);});document.getElementById('next-month').addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();const currentMonth=document.getElementById('current-month').textContent;const[monthName,year]=currentMonth.split(' ');const monthIndex=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"].indexOf(monthName);const newDate=new Date(parseInt(year),monthIndex+1,1);displayCalendar(newDate);});document.getElementById('change-date').addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();document.getElementById('time-selection').style.display='none';document.getElementById('date-selection').style.display='block';selectedTime=null;disableBuyNowButton();document.getElementById('booking-summary').style.display='none';});} function hideAndSetQuantity(){const quantityInput=document.getElementById('Quantity');if (quantityInput){quantityInput.value='1';quantityInput.style.display='none';const quantityContainer=quantityInput.closest('.product-form__quantity')||quantityInput.closest('.quantity-selector')||quantityInput.closest('.quantity')||quantityInput.closest('quantity-input');if (quantityContainer){quantityContainer.style.display='none';} const quantityLabel=document.querySelector('label[for=\"Quantity\"]');if (quantityLabel){quantityLabel.style.display='none';} console.log('Hidden quantity input and set to 1');} const quantityInputElements=document.querySelectorAll('quantity-input');quantityInputElements.forEach(element=>{element.style.display='none';const input=element.querySelector('input[name=\"quantity\"]');if (input){input.value='1';}});const quantityButtons=document.querySelectorAll('.quantity-button,.quantity__button,[data-quantity-button]');quantityButtons.forEach(button=>{button.style.display='none';});const quantityObserver=new MutationObserver((mutations)=>{const quantity=document.getElementById('Quantity');if (quantity&&quantity.style.display!=='none'){quantity.value='1';quantity.style.display='none';const container=quantity.closest('.product-form__quantity')||quantity.closest('.quantity-selector')||quantity.closest('.quantity')||quantity.closest('quantity-input');if (container){container.style.display='none';} console.log('Hidden dynamically loaded quantity input');} const quantityInputs=document.querySelectorAll('quantity-input');quantityInputs.forEach(qInput=>{if (qInput.style.display!=='none'){qInput.style.display='none';const input=qInput.querySelector('input[name=\"quantity\"]');if (input){input.value='1';} console.log('Hidden dynamically loaded quantity-input element');}});const quantityButtons=document.querySelectorAll('.quantity__button:not([style*=\"display:none\"])');quantityButtons.forEach(button=>{button.style.display='none';});});quantityObserver.observe(document.body,{childList:true,subtree:true});} function hideAddToCartButton(){const addToCartButton=document.getElementById('AddToCart');if (addToCartButton){addToCartButton.style.display='none';console.log('Hidden AddToCart button');const parent=addToCartButton.parentElement;if (parent&&parent.children.length===1){parent.style.display='none';}} const addToCartSelectors=['#AddToCartButton','button[name=\"add\"]:not(#BuyNowButton)','input[name=\"add\"]:not(#BuyNowButton)','button[type=\"submit\"]:not(#BuyNowButton)','.product-form__cart-submit:not(#BuyNowButton)','.btn--add-to-cart'];addToCartSelectors.forEach(selector=>{const buttons=document.querySelectorAll(selector);buttons.forEach(button=>{if (button.id!=='BuyNowButton'&&!button.classList.contains('buy-now')){button.style.display='none';console.log('Hidden button:',selector);}});});const observer=new MutationObserver((mutations)=>{const addToCart=document.getElementById('AddToCart');if (addToCart&&addToCart.style.display!=='none'){addToCart.style.display='none';console.log('Hidden dynamically loaded AddToCart button');}});observer.observe(document.body,{childList:true,subtree:true});} function disableBuyNowButton(){const buyNowButton=document.getElementById('BuyNowButton');if (buyNowButton){buyNowButton.disabled=true;buyNowButton.setAttribute('disabled','disabled');buyNowButton.style.opacity='0.5';buyNowButton.style.cursor='not-allowed';buyNowButton.style.pointerEvents='none';buyNowButton.onclick=function (e){if (!selectedDate||!selectedTime){e.preventDefault();e.stopPropagation();return false;}};}} function enableBuyNowButton(){if (selectedDate&&selectedTime){const buyNowButton=document.getElementById('BuyNowButton');if (buyNowButton){buyNowButton.disabled=false;buyNowButton.removeAttribute('disabled');buyNowButton.style.opacity='1';buyNowButton.style.cursor='pointer';buyNowButton.style.pointerEvents='auto';const originalType=buyNowButton.type;buyNowButton.type='button';buyNowButton.addEventListener('click',function handleBuyNow(e){e.preventDefault();e.stopPropagation();buyNowButton.classList.add('btn--loading');buyNowButton.disabled=true;console.log('Intercepting Buy Now to clear cart first...');updateEasyStoreForm();fetch('/new_cart',{method:'GET',headers:{'X-Requested-With':'XMLHttpRequest','Accept':'application/json'}}).then(response=>response.json()).then(cartData=>{const cart=cartData.cart||cartData;if (cart&&cart.items&&cart.items.length>0){console.log('Found '+cart.items.length+' items in cart,removing them...');let itemsToRemove=cart.items.length;let itemsProcessed=0;let allSuccess=true;function proceedWithBuyNow(){fetch('/new_cart',{method:'GET',headers:{'X-Requested-With':'XMLHttpRequest','Accept':'application/json'}}).then(response=>response.json()).then(verifyData=>{const verifyCart=verifyData.cart||verifyData;const remainingItems=verifyCart.items ? verifyCart.items.length:0;console.log('Cart verification-remaining items:',remainingItems);buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;setTimeout(()=>{console.log('Triggering original Buy Now...');if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();} setTimeout(()=>{buyNowButton.type='button';buyNowButton.addEventListener('click',handleBuyNow);},3000);},1000);}).catch (error=>{console.error('Error verifying cart:',error);buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;setTimeout(()=>{if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();}},500);});} const removalPromises=cart.items.map(item=>{const variantId=item.variant_id||(item.variant&&item.variant.id);return fetch('/cart/remove_item_quantity',{method:'POST',headers:{'Content-Type':'application/json','X-Requested-With':'XMLHttpRequest'},body:JSON.stringify({variant_id:variantId.toString(),item_id:item.id.toString(),quantity:item.quantity.toString()})}).then(response=>response.json()).then(result=>{console.log(`Removed item ${item.id}`);return true;}).catch (error=>{console.error('Error removing item:',error);allSuccess=false;return false;});});Promise.all(removalPromises).then(results=>{console.log('All removal requests completed');setTimeout(proceedWithBuyNow,500);});} else {console.log('Cart is empty,proceeding with Buy Now...');buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();} setTimeout(()=>{buyNowButton.type='button';buyNowButton.addEventListener('click',handleBuyNow);},2000);}}).catch (error=>{console.error('Error retrieving cart:',error);buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();}});});}}} function addCustomStyles(){const style=document.createElement('style');style.textContent=` .booking-widget-container {background:#ffffff;border:none;border-radius:12px;padding:32px;margin:24px 0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;box-shadow:0 2px 8px rgba(0,0,0,0.08);}.booking-step h4 {color:#1a1a1a;margin-bottom:20px;font-size:16px;font-weight:600;text-transform:none;letter-spacing:normal;}.calendar-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:28px;}.nav-button {background:transparent;color:#1a1a1a;border:none;padding:8px;border-radius:8px;cursor:pointer;font-size:20px;transition:all 0.2s ease;width:36px;height:36px;display:flex;align-items:center;justify-content:center;}.nav-button:hover {background:#f5f5f5;}#current-month {font-weight:600;font-size:18px;color:#1a1a1a;}.calendar-row {display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:4px;}.calendar-day-header {text-align:center;font-weight:600;padding:12px 4px;font-size:12px;color:#666;text-transform:uppercase;letter-spacing:0.5px;}.calendar-day {text-align:center;padding:0;background:transparent;cursor:pointer;min-height:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:14px;color:#1a1a1a;transition:all 0.15s ease;border-radius:8px;position:relative;font-weight:500;}.calendar-day.other-month {color:#ccc;cursor:default;}.calendar-day.disabled {color:#ccc;cursor:not-allowed;}.calendar-day.has-availability {color:#1a1a1a;}.calendar-day.has-availability:hover {background:#f5f5f5;}.calendar-day.fully-booked {color:#ccc;cursor:not-allowed;text-decoration:line-through;}.calendar-day.selected {background:#0066ff!important;color:white;font-weight:600;}#time-slots {display:flex;flex-direction:column;gap:12px;margin:24px 0;}.time-slot {padding:16px 20px;border:2px solid #e5e7eb;background:white;border-radius:10px;cursor:pointer;font-size:16px;font-weight:500;transition:all 0.15s ease;text-align:center;color:#1a1a1a;}.time-slot.available:hover {border-color:#0066ff;background:#f0f7ff;}.time-slot.selected {background:#0066ff;color:white;border-color:#0066ff;}.time-slot.booked {background:#f9fafb;color:#9ca3af;cursor:not-allowed;border-color:#e5e7eb;}.secondary-button {background:transparent;color:#6b7280;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;margin-top:20px;font-size:14px;font-weight:500;transition:all 0.15s ease;display:inline-flex;align-items:center;gap:8px;}.secondary-button:hover {background:#f5f5f5;color:#1a1a1a;}.booking-summary {background:#f0f7ff;border:2px solid #0066ff;border-radius:10px;padding:20px;margin-top:24px;}.booking-detail {margin:8px 0;font-size:16px;color:#1a1a1a;font-weight:500;}.loading-indicator,.loading,.error,.no-slots {text-align:center;padding:20px;color:#999;font-size:14px;}.error {color:#d32f2f;}#BuyNowButton {position:relative;}#calendar-grid {border:none;border-radius:12px;overflow:visible;background:transparent;}.calendar-header-row {margin-bottom:16px;}#booking-widget button:not(#BuyNowButton){type:button!important;}`;document.head.appendChild(style);} function hideCartButton(){const cartButton=document.getElementById('cart-icon-bubble');if (cartButton){cartButton.style.display='none';console.log('Hidden cart button');} const observer=new MutationObserver((mutations)=>{const cartBtn=document.getElementById('cart-icon-bubble');if (cartBtn&&cartBtn.style.display!=='none'){cartBtn.style.display='none';console.log('Hidden dynamically loaded cart button');}});observer.observe(document.body,{childList:true,subtree:true});} ready(function (){initBookingWidget();hideCartButton();});})();</script>
=== END ===

File size comparison:
- Original: 44581 characters
- Minified: 22304 characters
- Reduction: 50%

Instructions for Postman:
1. Copy the escaped content between START and END markers above
2. In Postman, use this in your request body for the snippet field
3. This will embed the booking widget directly in the page without external script loading

Alternative: If you need just the minified JavaScript (no HTML wrapper):
=== MINIFIED JS START ===
(function (){'use strict';const CONFIG={availabilityEndpoint:window.location.hostname.includes('ngrok')? `${window.location.protocol}:'https:daysAhead:30,minDaysAhead:2};let selectedDate=null;let selectedTime=null;let availabilityCache={};let businessHours=null;function ready(fn){if (document.readyState!=='loading'){fn();} else {document.addEventListener('DOMContentLoaded',fn);}} function initBookingWidget(){const buyNowButton=document.getElementById('BuyNowButton');if (!buyNowButton){console.log('BuyNowButton not found,retrying in 1 second...');setTimeout(initBookingWidget,1000);return;} buyNowButton.disabled=true;buyNowButton.style.opacity='0.5';buyNowButton.style.cursor='not-allowed';hideAddToCartButton();hideAndSetQuantity();createBookingWidget(buyNowButton);addCustomStyles();setTimeout(()=>disableBuyNowButton(),100);} function createBookingWidget(buyNowButton){const bookingContainer=document.createElement('div');bookingContainer.id='booking-widget';bookingContainer.innerHTML=`<div class=\"booking-widget-container\"><div class=\"booking-step\"id=\"date-selection\"><h4>Choose a Date</h4><div id=\"calendar-container\"><div class=\"calendar-header\"><button id=\"prev-month\"class=\"nav-button\"><svg width=\"20\"height=\"20\"viewBox=\"0 0 24 24\"fill=\"none\"stroke=\"currentColor\"stroke-width=\"2\"stroke-linecap=\"round\"stroke-linejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg></button><span id=\"current-month\"></span><button id=\"next-month\"class=\"nav-button\"><svg width=\"20\"height=\"20\"viewBox=\"0 0 24 24\"fill=\"none\"stroke=\"currentColor\"stroke-width=\"2\"stroke-linecap=\"round\"stroke-linejoin=\"round\"><polyline points=\"9 18 15 12 9 6\"></polyline></svg></button></div><div id=\"calendar-grid\"></div></div><div id=\"availability-loading\"class=\"loading-indicator\"style=\"display:none;\">Checking availability...</div></div><div class=\"booking-step\"id=\"time-selection\"style=\"display:none;\"><h4>Choose a Time</h4><div id=\"time-slots\"></div><button id=\"change-date\"class=\"secondary-button\"><svg width=\"16\"height=\"16\"viewBox=\"0 0 24 24\"fill=\"none\"stroke=\"currentColor\"stroke-width=\"2\"stroke-linecap=\"round\"stroke-linejoin=\"round\"><polyline points=\"15 18 9 12 15 6\"></polyline></svg>Change Date</button></div><div class=\"booking-summary\"id=\"booking-summary\"style=\"display:none;\"><div class=\"summary-content\"><strong>Selected Booking:</strong><div id=\"selected-booking-details\"></div></div></div></div>`;buyNowButton.parentNode.insertBefore(bookingContainer,buyNowButton);initCalendar();setupEventListeners();} function initCalendar(){const today=new Date();const minDate=new Date(today);minDate.setDate(today.getDate()+CONFIG.minDaysAhead);displayCalendar(minDate);} function displayCalendar(date){const monthNames=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"];const dayNames=[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"];const currentMonth=document.getElementById('current-month');const calendarGrid=document.getElementById('calendar-grid');currentMonth.textContent=`${monthNames[date.getMonth()]}${date.getFullYear()}`;calendarGrid.innerHTML='';const headerRow=document.createElement('div');headerRow.className='calendar-row calendar-header-row';dayNames.forEach(day=>{const dayHeader=document.createElement('div');dayHeader.className='calendar-day-header';dayHeader.textContent=day;headerRow.appendChild(dayHeader);});calendarGrid.appendChild(headerRow);const firstDay=new Date(date.getFullYear(),date.getMonth(),1);const lastDay=new Date(date.getFullYear(),date.getMonth()+1,0);const startDate=new Date(firstDay);startDate.setDate(startDate.getDate()-firstDay.getDay());const today=new Date();const minBookingDate=new Date(today);minBookingDate.setDate(today.getDate()+CONFIG.minDaysAhead);let currentDate=new Date(startDate);while (currentDate<=lastDay||currentDate.getDay()!==0){const row=document.createElement('div');row.className='calendar-row';for (let i=0;i<7;i++){const dayElement=document.createElement('div');dayElement.className='calendar-day';const isCurrentMonth=currentDate.getMonth()===date.getMonth();const isPastDate=currentDate<minBookingDate;const isTooFarAhead=currentDate>new Date(today.getFullYear(),today.getMonth(),today.getDate()+CONFIG.daysAhead);if (!isCurrentMonth){dayElement.classList.add('other-month');} else if (isPastDate||isTooFarAhead){dayElement.classList.add('disabled');} else {dayElement.classList.add('available-date');(function (capturedDate){dayElement.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();selectDate(new Date(capturedDate));});})(new Date(currentDate));} dayElement.textContent=currentDate.getDate();dayElement.dataset.date=currentDate.toISOString().split('T')[0];row.appendChild(dayElement);currentDate.setDate(currentDate.getDate()+1);} calendarGrid.appendChild(row);} loadAvailabilityForMonth(date);} async function loadAvailabilityForMonth(date){const loadingIndicator=document.getElementById('availability-loading');loadingIndicator.style.display='block';try {const startDate=new Date(date.getFullYear(),date.getMonth(),1);const endDate=new Date(date.getFullYear(),date.getMonth()+1,0);const response=await fetch(`${CONFIG.availabilityEndpoint}?start=${startDate.toISOString().split('T')[0]}&end=${endDate.toISOString().split('T')[0]}`);const availability=await response.json();if (availability.businessHours){businessHours=availability.businessHours;console.log('Stored business hours from month view:',businessHours);} availability.dates.forEach(dateInfo=>{const dayElement=document.querySelector(`[data-date=\"${dateInfo.date}\"]`);if (dayElement&&dayElement.classList.contains('available-date')){if (dateInfo.available){dayElement.classList.add('has-availability');} else {dayElement.classList.add('fully-booked');}}});availability.dates.forEach(dateInfo=>{availabilityCache[dateInfo.date]=dateInfo.slots;});} catch (error){console.error('Error loading availability:',error);document.querySelectorAll('.available-date').forEach(day=>{day.classList.add('has-availability');});} loadingIndicator.style.display='none';} async function selectDate(date){const dateStr=date.toISOString().split('T')[0];selectedDate=dateStr;document.querySelectorAll('.calendar-day').forEach(day=>{day.classList.remove('selected');});const selectedDay=document.querySelector(`[data-date=\"${dateStr}\"]`);if (selectedDay){selectedDay.classList.add('selected');} await loadTimeSlots(date);document.getElementById('date-selection').style.display='none';document.getElementById('time-selection').style.display='block';} async function loadTimeSlots(date){const timeSlotsContainer=document.getElementById('time-slots');timeSlotsContainer.innerHTML='<div class=\"loading\">Loading available times...</div>';try {const dateStr=date.toISOString().split('T')[0];let availableSlots=availabilityCache[dateStr];if (!availableSlots||!businessHours){console.log('Fetching availability for date:',dateStr);const response=await fetch(`${CONFIG.availabilityEndpoint}?date=${dateStr}`);const data=await response.json();console.log('API response:',data);availableSlots=data.slots||[];if (data.businessHours){businessHours=data.businessHours;console.log('Loaded business hours from API:',businessHours);}} const dayName=date.toLocaleDateString('en-US',{weekday:'long'});if (!businessHours){console.error('Business hours not loaded!This should not happen.');timeSlotsContainer.innerHTML='<div class=\"error\">Error:Business hours not loaded. Please refresh and try again.</div>';return;} const dayBusinessHours=businessHours[dayName]||[];console.log(`Time slots for ${dayName}:`,dayBusinessHours);if (dayBusinessHours.length===0){timeSlotsContainer.innerHTML='<div class=\"no-slots\">Sorry,we\\'re closed on this day.</div>';return;} timeSlotsContainer.innerHTML='';let hasAvailableSlots=false;dayBusinessHours.forEach(time=>{const slotButton=document.createElement('button');slotButton.className='time-slot';slotButton.textContent=time;const isAvailable=!availableSlots||availableSlots.includes(time);if (isAvailable){hasAvailableSlots=true;slotButton.classList.add('available');slotButton.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();selectTime(time,e);});} else {slotButton.classList.add('booked');slotButton.disabled=true;} timeSlotsContainer.appendChild(slotButton);});if (!hasAvailableSlots){const noSlotsMsg=document.createElement('div');noSlotsMsg.className='no-slots';noSlotsMsg.textContent='Sorry,no time slots available on this date.';timeSlotsContainer.appendChild(noSlotsMsg);}} catch (error){console.error('Error loading time slots:',error);timeSlotsContainer.innerHTML='<div class=\"error\">Error loading times. Please try again.</div>';}} function selectTime(time,event){selectedTime=time;document.querySelectorAll('.time-slot').forEach(slot=>{slot.classList.remove('selected');});if (event&&event.target){event.target.classList.add('selected');} updateBookingSummary();enableBuyNowButton();} function updateBookingSummary(){const summaryContainer=document.getElementById('booking-summary');const detailsContainer=document.getElementById('selected-booking-details');if (selectedDate&&selectedTime){const date=new Date(selectedDate);const formattedDate=date.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});detailsContainer.innerHTML=`<div class=\"booking-detail\">${formattedDate}</div><div class=\"booking-detail\">${selectedTime}</div>`;summaryContainer.style.display='block';updateEasyStoreForm();}} function updateEasyStoreForm(){const form=document.getElementById('BuyNowButton')?.closest('form');if (!form) return;let bookingDateInput=form.querySelector('input[name=\"properties[Booking Date]\"]');let bookingTimeInput=form.querySelector('input[name=\"properties[Booking Time]\"]');if (!bookingDateInput){bookingDateInput=document.createElement('input');bookingDateInput.type='hidden';bookingDateInput.name='properties[Booking Date]';form.appendChild(bookingDateInput);} if (!bookingTimeInput){bookingTimeInput=document.createElement('input');bookingTimeInput.type='hidden';bookingTimeInput.name='properties[Booking Time]';form.appendChild(bookingTimeInput);} bookingDateInput.value=selectedDate;bookingTimeInput.value=selectedTime;} function setupEventListeners(){document.getElementById('prev-month').addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();const currentMonth=document.getElementById('current-month').textContent;const[monthName,year]=currentMonth.split(' ');const monthIndex=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"].indexOf(monthName);const newDate=new Date(parseInt(year),monthIndex-1,1);displayCalendar(newDate);});document.getElementById('next-month').addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();const currentMonth=document.getElementById('current-month').textContent;const[monthName,year]=currentMonth.split(' ');const monthIndex=[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"].indexOf(monthName);const newDate=new Date(parseInt(year),monthIndex+1,1);displayCalendar(newDate);});document.getElementById('change-date').addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();document.getElementById('time-selection').style.display='none';document.getElementById('date-selection').style.display='block';selectedTime=null;disableBuyNowButton();document.getElementById('booking-summary').style.display='none';});} function hideAndSetQuantity(){const quantityInput=document.getElementById('Quantity');if (quantityInput){quantityInput.value='1';quantityInput.style.display='none';const quantityContainer=quantityInput.closest('.product-form__quantity')||quantityInput.closest('.quantity-selector')||quantityInput.closest('.quantity')||quantityInput.closest('quantity-input');if (quantityContainer){quantityContainer.style.display='none';} const quantityLabel=document.querySelector('label[for=\"Quantity\"]');if (quantityLabel){quantityLabel.style.display='none';} console.log('Hidden quantity input and set to 1');} const quantityInputElements=document.querySelectorAll('quantity-input');quantityInputElements.forEach(element=>{element.style.display='none';const input=element.querySelector('input[name=\"quantity\"]');if (input){input.value='1';}});const quantityButtons=document.querySelectorAll('.quantity-button,.quantity__button,[data-quantity-button]');quantityButtons.forEach(button=>{button.style.display='none';});const quantityObserver=new MutationObserver((mutations)=>{const quantity=document.getElementById('Quantity');if (quantity&&quantity.style.display!=='none'){quantity.value='1';quantity.style.display='none';const container=quantity.closest('.product-form__quantity')||quantity.closest('.quantity-selector')||quantity.closest('.quantity')||quantity.closest('quantity-input');if (container){container.style.display='none';} console.log('Hidden dynamically loaded quantity input');} const quantityInputs=document.querySelectorAll('quantity-input');quantityInputs.forEach(qInput=>{if (qInput.style.display!=='none'){qInput.style.display='none';const input=qInput.querySelector('input[name=\"quantity\"]');if (input){input.value='1';} console.log('Hidden dynamically loaded quantity-input element');}});const quantityButtons=document.querySelectorAll('.quantity__button:not([style*=\"display:none\"])');quantityButtons.forEach(button=>{button.style.display='none';});});quantityObserver.observe(document.body,{childList:true,subtree:true});} function hideAddToCartButton(){const addToCartButton=document.getElementById('AddToCart');if (addToCartButton){addToCartButton.style.display='none';console.log('Hidden AddToCart button');const parent=addToCartButton.parentElement;if (parent&&parent.children.length===1){parent.style.display='none';}} const addToCartSelectors=['#AddToCartButton','button[name=\"add\"]:not(#BuyNowButton)','input[name=\"add\"]:not(#BuyNowButton)','button[type=\"submit\"]:not(#BuyNowButton)','.product-form__cart-submit:not(#BuyNowButton)','.btn--add-to-cart'];addToCartSelectors.forEach(selector=>{const buttons=document.querySelectorAll(selector);buttons.forEach(button=>{if (button.id!=='BuyNowButton'&&!button.classList.contains('buy-now')){button.style.display='none';console.log('Hidden button:',selector);}});});const observer=new MutationObserver((mutations)=>{const addToCart=document.getElementById('AddToCart');if (addToCart&&addToCart.style.display!=='none'){addToCart.style.display='none';console.log('Hidden dynamically loaded AddToCart button');}});observer.observe(document.body,{childList:true,subtree:true});} function disableBuyNowButton(){const buyNowButton=document.getElementById('BuyNowButton');if (buyNowButton){buyNowButton.disabled=true;buyNowButton.setAttribute('disabled','disabled');buyNowButton.style.opacity='0.5';buyNowButton.style.cursor='not-allowed';buyNowButton.style.pointerEvents='none';buyNowButton.onclick=function (e){if (!selectedDate||!selectedTime){e.preventDefault();e.stopPropagation();return false;}};}} function enableBuyNowButton(){if (selectedDate&&selectedTime){const buyNowButton=document.getElementById('BuyNowButton');if (buyNowButton){buyNowButton.disabled=false;buyNowButton.removeAttribute('disabled');buyNowButton.style.opacity='1';buyNowButton.style.cursor='pointer';buyNowButton.style.pointerEvents='auto';const originalType=buyNowButton.type;buyNowButton.type='button';buyNowButton.addEventListener('click',function handleBuyNow(e){e.preventDefault();e.stopPropagation();buyNowButton.classList.add('btn--loading');buyNowButton.disabled=true;console.log('Intercepting Buy Now to clear cart first...');updateEasyStoreForm();fetch('/new_cart',{method:'GET',headers:{'X-Requested-With':'XMLHttpRequest','Accept':'application/json'}}).then(response=>response.json()).then(cartData=>{const cart=cartData.cart||cartData;if (cart&&cart.items&&cart.items.length>0){console.log('Found '+cart.items.length+' items in cart,removing them...');let itemsToRemove=cart.items.length;let itemsProcessed=0;let allSuccess=true;function proceedWithBuyNow(){fetch('/new_cart',{method:'GET',headers:{'X-Requested-With':'XMLHttpRequest','Accept':'application/json'}}).then(response=>response.json()).then(verifyData=>{const verifyCart=verifyData.cart||verifyData;const remainingItems=verifyCart.items ? verifyCart.items.length:0;console.log('Cart verification-remaining items:',remainingItems);buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;setTimeout(()=>{console.log('Triggering original Buy Now...');if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();} setTimeout(()=>{buyNowButton.type='button';buyNowButton.addEventListener('click',handleBuyNow);},3000);},1000);}).catch (error=>{console.error('Error verifying cart:',error);buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;setTimeout(()=>{if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();}},500);});} const removalPromises=cart.items.map(item=>{const variantId=item.variant_id||(item.variant&&item.variant.id);return fetch('/cart/remove_item_quantity',{method:'POST',headers:{'Content-Type':'application/json','X-Requested-With':'XMLHttpRequest'},body:JSON.stringify({variant_id:variantId.toString(),item_id:item.id.toString(),quantity:item.quantity.toString()})}).then(response=>response.json()).then(result=>{console.log(`Removed item ${item.id}`);return true;}).catch (error=>{console.error('Error removing item:',error);allSuccess=false;return false;});});Promise.all(removalPromises).then(results=>{console.log('All removal requests completed');setTimeout(proceedWithBuyNow,500);});} else {console.log('Cart is empty,proceeding with Buy Now...');buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();} setTimeout(()=>{buyNowButton.type='button';buyNowButton.addEventListener('click',handleBuyNow);},2000);}}).catch (error=>{console.error('Error retrieving cart:',error);buyNowButton.classList.remove('btn--loading');buyNowButton.disabled=false;buyNowButton.removeEventListener('click',handleBuyNow);buyNowButton.type=originalType;if (window.jQuery){window.jQuery('#BuyNowButton').click();} else {buyNowButton.click();}});});}}} function addCustomStyles(){const style=document.createElement('style');style.textContent=` .booking-widget-container {background:#ffffff;border:none;border-radius:12px;padding:32px;margin:24px 0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;box-shadow:0 2px 8px rgba(0,0,0,0.08);}.booking-step h4 {color:#1a1a1a;margin-bottom:20px;font-size:16px;font-weight:600;text-transform:none;letter-spacing:normal;}.calendar-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:28px;}.nav-button {background:transparent;color:#1a1a1a;border:none;padding:8px;border-radius:8px;cursor:pointer;font-size:20px;transition:all 0.2s ease;width:36px;height:36px;display:flex;align-items:center;justify-content:center;}.nav-button:hover {background:#f5f5f5;}#current-month {font-weight:600;font-size:18px;color:#1a1a1a;}.calendar-row {display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:4px;}.calendar-day-header {text-align:center;font-weight:600;padding:12px 4px;font-size:12px;color:#666;text-transform:uppercase;letter-spacing:0.5px;}.calendar-day {text-align:center;padding:0;background:transparent;cursor:pointer;min-height:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:14px;color:#1a1a1a;transition:all 0.15s ease;border-radius:8px;position:relative;font-weight:500;}.calendar-day.other-month {color:#ccc;cursor:default;}.calendar-day.disabled {color:#ccc;cursor:not-allowed;}.calendar-day.has-availability {color:#1a1a1a;}.calendar-day.has-availability:hover {background:#f5f5f5;}.calendar-day.fully-booked {color:#ccc;cursor:not-allowed;text-decoration:line-through;}.calendar-day.selected {background:#0066ff!important;color:white;font-weight:600;}#time-slots {display:flex;flex-direction:column;gap:12px;margin:24px 0;}.time-slot {padding:16px 20px;border:2px solid #e5e7eb;background:white;border-radius:10px;cursor:pointer;font-size:16px;font-weight:500;transition:all 0.15s ease;text-align:center;color:#1a1a1a;}.time-slot.available:hover {border-color:#0066ff;background:#f0f7ff;}.time-slot.selected {background:#0066ff;color:white;border-color:#0066ff;}.time-slot.booked {background:#f9fafb;color:#9ca3af;cursor:not-allowed;border-color:#e5e7eb;}.secondary-button {background:transparent;color:#6b7280;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;margin-top:20px;font-size:14px;font-weight:500;transition:all 0.15s ease;display:inline-flex;align-items:center;gap:8px;}.secondary-button:hover {background:#f5f5f5;color:#1a1a1a;}.booking-summary {background:#f0f7ff;border:2px solid #0066ff;border-radius:10px;padding:20px;margin-top:24px;}.booking-detail {margin:8px 0;font-size:16px;color:#1a1a1a;font-weight:500;}.loading-indicator,.loading,.error,.no-slots {text-align:center;padding:20px;color:#999;font-size:14px;}.error {color:#d32f2f;}#BuyNowButton {position:relative;}#calendar-grid {border:none;border-radius:12px;overflow:visible;background:transparent;}.calendar-header-row {margin-bottom:16px;}#booking-widget button:not(#BuyNowButton){type:button!important;}`;document.head.appendChild(style);} function hideCartButton(){const cartButton=document.getElementById('cart-icon-bubble');if (cartButton){cartButton.style.display='none';console.log('Hidden cart button');} const observer=new MutationObserver((mutations)=>{const cartBtn=document.getElementById('cart-icon-bubble');if (cartBtn&&cartBtn.style.display!=='none'){cartBtn.style.display='none';console.log('Hidden dynamically loaded cart button');}});observer.observe(document.body,{childList:true,subtree:true});} ready(function (){initBookingWidget();hideCartButton();});})();
=== MINIFIED JS END ===
